package com.mindfire.weatherservice.service;

import org.springframework.context.annotation.Bean;
import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;
import org.springframework.web.server.ResponseStatusException;

import com.mindfire.weatherservice.dto.Weather;

@Service
public class WeatherService {
	
	@Bean
	RestTemplate restTemplate() {
		
		return new RestTemplate();
	};
	
	
	/**
	 *  This method is used to get Weather Details of any city
	 * @param city
	 * @return
	 */
	public Weather getWeatherReport(String city)  {		
			String url="http://api.weatherapi.com/v1/forecast.json?key=483a04daff914ce58f991903220803&q={city}&days={days}";
		ResponseEntity<Weather> response = this.restTemplate().getForEntity(url, Weather.class,city,"1");
		if(response.getStatusCodeValue()==200) {
			return response.getBody();
		}else if(response.getStatusCodeValue()==404){
			throw new ResponseStatusException(
			           HttpStatus.NOT_FOUND, "City Not Found");
		}else {
			throw new ResponseStatusException(HttpStatus.INTERNAL_SERVER_ERROR, "Unknown Weather Api error");
		}
		return null;
		}
}
