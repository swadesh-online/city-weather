package com.mindfire.cityservice.service;

import java.util.ArrayList;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.mindfire.cityservice.dto.CityWeatherReport;
import com.mindfire.cityservice.dto.Weather;
import com.mindfire.cityservice.model.City;
import com.mindfire.cityservice.repository.CityRepository;

@Service
public class CityService {
	
	
	@Autowired
	WeatherConsumerService weatherConsumer;
	
	@Autowired
	CityRepository cityRepository;
	

	
	/**
	 *  This method adds city to the cityList
	 * 
	 * @param cityName - The name of the city to be added
	 * @return List<City> - updated cityList
	 * 
	 */
	public List<City> add(String cityName){
		
		// Checks if city is already present, else add it to the DB
		List<City> existingCities = cityRepository.findAll();
		boolean cityFound=false;
		for(City city:existingCities) {
			
			if(city.getName().equalsIgnoreCase(cityName)) {
				
				cityFound=true; 
				break;
			}
		}
		if(!cityFound) {
			
			cityRepository.save(new City(cityName.toLowerCase()));
		}
		
		return cityRepository.findAll();
	}
	
	/**
	 *  This method is used to fetch all cities from the cityList
	 *  
	 * @return List<City> - updated cityList
	 * 
	 */
	public List<City> fetchAll() {
		
		return cityRepository.findAll();
	}


	/**
	 *  This method is used to remove city from the cityList
	 *  
	 * @param cityName - The name of city to be removed
	 * @return List<City> - updated cityList
	 * 
	 */
	public List<City> delete(String cityId) {
		
		// Checks if the cityName is present in the list, if found removes it. 
		List<City> existingCities = cityRepository.findAll();
		for(City city: existingCities) {
			
			if(city.getId().equals(cityId)) {
				
				cityRepository.delete(city);
				
			}
		}
		
		return cityRepository.findAll();
	}
}
