package com.mindfire.weatherservice.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.web.client.RestTemplateBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;
import org.springframework.web.client.RestTemplate;

import com.mindfire.weatherservice.dto.Weather;
import com.mindfire.weatherservice.handler.RestTemplateResponseErrorHandler;

@Service
public class WeatherService {
	
    private RestTemplate restTemplate;

    @Autowired
    public WeatherService(RestTemplateBuilder restTemplateBuilder) {
        RestTemplate restTemplate = restTemplateBuilder
          .errorHandler(new RestTemplateResponseErrorHandler())
          .build();
    }

	
	
	/**
	 *  This method is used to get Weather Details of any city
	 * @param city
	 * @return
	 */
	public ResponseEntity<Weather> getWeatherReport(String city)  {	
			String formattedCityName= city.trim().replaceAll(" ", "");
		String url="http://api.weatherapi.com/v1/forecast.json?key=483a04daff914ce58f991903220803&q={city}&days={days}";
		ResponseEntity<Weather> response = restTemplate.getForEntity(url, Weather.class,formattedCityName,"1");
		
		return response;
}
}
